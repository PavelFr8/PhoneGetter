# Документация для кода на плату Arduino Mega + ESP8266 Robodyn 


# Текст ниже является только первоначальной версией продукта!


Этот код реализует взаимодействие между Arduino Mega и ESP8266 на плате RobotDyn, обеспечивая подключение к API сайта для управления данными устройства, а также самим устройством.  
Документация предназначена для размещения на GitHub и описывает архитектуру, функциональность и использование программного обеспечения.

---

## Содержание

- [Описание](#описание-проекта)
- [Общая архитектура](#общая-архитектура)
- [Схема подключения](#схема-подключения)
- [Установка](#установка)
- [Код для Arduino Mega](#код-для-arduino-mega)
- [Код для ESP8266](#код-для-esp8266)
- [Протокол взаимодействия](#протокол-взаимодействия)

---

## Описание

Плата RobotDyn Arduino Mega + ESP8266 позволяет интегрировать микроконтроллер Mega2560 и модуль Wi-Fi ESP8266 в одном устройстве. Функции, выполняемые устроством:

- Установка соединения с Wi-Fi.
- Передача данных о состоянии ячеек (например, клетки устройств).
- Обмена данными с сервером через HTTP API.
- Управления состоянием устройства на основе данных сервера.

---

## Общая архитектура

В проекте используются:

1. **Arduino Mega** для управления состояниями ячеек и взаимодействия с ESP8266.
2. **ESP8266** для работы с API сайта.

Обмен данными между Mega и ESP осуществляется через интерфейс `Serial3`.

---

## Схема подключения

- **Serial3 на Arduino Mega** соединён с **ESP8266** для передачи данных.
- Пины `22-53` на Mega используются для управления LED-индикаторами клеток.

---

## Установка

### Требования

1. Arduino IDE версии 1.8.19 или выше.
2. Библиотеки:
   - `ArduinoJson`
   - `ESP8266WiFi`
   - `ESP8266HTTPClient`

### Шаги установки

1. Скачайте репозиторий.
2. Загрузите файл `arduino_mega.ino` в Arduino Mega.
3. Загрузите файл `esp8266.ino` в ESP8266.
4. Настройте переключатель режимов на плате RobotDyn:
   - `TXD3/RXD3` для взаимодействия между Mega и ESP.

---

## Код для Arduino Mega

Файл: `arduino_mega.ino`

### Функциональность

1. **Инициализация устройства:**
   - Проверка статуса настройки (`EEPROM.read`).
   - Если настройка не завершена, запрашиваются Wi-Fi данные.
2. **Настройка Wi-Fi:**  
   Передача данных для подключения на ESP через команду `SET_WIFI:<SSID>:<Password>`.
3. **Обработка данных ячеек:**
   - Запрос данных с сервера (`GIVE_DATA`).
   - Управление LED на основе состояния ячеек.
4. **Парсинг данных ячеек:**  
   Конвертация строки данных от ESP в структуру `CellData`.
5. **Основные команды:**
   - `RESET`: Сброс статуса настройки.
   - `DATA`: Запрос данных о ячейках.
   - `LEDS`: Зажигает светодиоды, которые соответствуют клеткам со значением True.

---

## Код для ESP8266

Файл: `esp8266.ino`

### Функциональность

1. **Подключение к Wi-Fi:**  
   Считывание данных из EEPROM, установка соединения с заданным SSID и паролем.
2. **Работа с сервером:**
   - Получение данных о состоянии ячеек (`give_data`).
   - Обновление состояния ячеек (`update_data`).
   - Получение секретного кода (`create_code`).
   - Сброс подключения (`reset_connection`).
3. **Обработка команд от Mega:**
   - `SET_WIFI:ssid:passwoed`: Установка Wi-Fi данных.
   - `UPDATE_DATA:changed_cell:state`: Установка Wi-Fi данных.
   - `GET_CODE`: Запрос секретного кода.
   - `GIVE_DATA`: Передача состояния ячеек на Mega.
   - `CLEAR`: Очистка EEPROM.

---

## Протокол взаимодействия

Взаимодействие между Arduino Mega и ESP8266 осуществляется через интерфейс `Serial3` (UART). Формат команд:  
`<COMMAND>:<PARAM1>:<PARAM2>:...`  
Ответы от ESP8266 передаются в виде текста.
